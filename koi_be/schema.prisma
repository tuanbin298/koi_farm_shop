// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource sqlite {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "sqlite"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                    String     @id @default(cuid())
  name                  String     @default("")
  email                 String     @unique @default("")
  password              String
  phone                 String     @default("")
  address               String     @default("")
  role                  Role?      @relation("User_role", fields: [roleId], references: [id])
  roleId                String?    @map("role")
  cart                  CartItem[] @relation("CartItem_user")
  from_Feedback_user    Feedback[] @relation("Feedback_user")
  from_Order_user       Order[]    @relation("Order_user")
  from_Request_user     Request[]  @relation("Request_user")
  from_Request_staff    Request[]  @relation("Request_staff")
  from_Status_changedBy Status[]   @relation("Status_changedBy")

  @@index([roleId])
}

model Role {
  id                  String  @id @default(cuid())
  name                String  @default("")
  canManageUser       Boolean @default(false)
  canManageProduct    Boolean @default(false)
  canManageRole       Boolean @default(false)
  canManageArticle    Boolean @default(false)
  canManageOrder      Boolean @default(false)
  canManageFeedback   Boolean @default(false)
  canManageCart       Boolean @default(false)
  canManageConsigment Boolean @default(false)
  canManageRequest    Boolean @default(false)
  canManageStatus     Boolean @default(false)
  user                User[]  @relation("User_role")
}

model Product {
  id                     String      @id @default(cuid())
  name                   String      @unique @default("")
  birth                  Int
  sex                    String?     @default("Sex")
  size                   String?     @default("Size")
  price                  Int
  description            String      @default("")
  origin                 String      @default("")
  generic                String      @default("")
  slug                   String      @unique @default("")
  image                  String?
  category               Category?   @relation("Product_category", fields: [categoryId], references: [id])
  categoryId             String?     @map("category")
  status                 String?
  from_Feedback_product  Feedback[]  @relation("Feedback_product")
  from_OrderItem_product OrderItem[] @relation("OrderItem_product")
  from_CartItem_product  CartItem[]  @relation("CartItem_product")

  @@index([categoryId])
}

model Category {
  id                    String    @id @default(cuid())
  name                  String    @default("")
  description           String    @default("")
  from_Product_category Product[] @relation("Product_category")
}

model Article {
  id      String  @id @default(cuid())
  name    String  @default("")
  content String  @default("")
  link    String  @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  image   String?
}

model Feedback {
  id        String    @id @default(cuid())
  user      User?     @relation("Feedback_user", fields: [userId], references: [id])
  userId    String?   @map("user")
  product   Product?  @relation("Feedback_product", fields: [productId], references: [id])
  productId String?   @map("product")
  comment   String    @default("")
  createdAt DateTime? @default(now())

  @@index([userId])
  @@index([productId])
}

model Order {
  id                   String      @id @default(cuid())
  user                 User?       @relation("Order_user", fields: [userId], references: [id])
  userId               String?     @map("user")
  items                OrderItem[] @relation("Order_items")
  price                Int?
  createAt             DateTime?   @default(now())
  address              String      @default("")
  status               String?     @default("Chờ xác nhận")
  from_OrderItem_order OrderItem[] @relation("OrderItem_order")

  @@index([userId])
}

model OrderItem {
  id                String           @id @default(cuid())
  order             Order?           @relation("OrderItem_order", fields: [orderId], references: [id])
  orderId           String?          @map("order")
  product           Product?         @relation("OrderItem_product", fields: [productId], references: [id])
  productId         String?          @map("product")
  consignmentSale   ConsignmentSale? @relation("OrderItem_consignmentSale", fields: [consignmentSaleId], references: [id])
  consignmentSaleId String?          @map("consignmentSale")
  quantity          Int
  price             Int
  isStored          Boolean          @default(false)
  from_Order_items  Order[]          @relation("Order_items")

  @@index([orderId])
  @@index([productId])
  @@index([consignmentSaleId])
}

model CartItem {
  id                 String            @id @default(cuid())
  user               User?             @relation("CartItem_user", fields: [userId], references: [id])
  userId             String?           @map("user")
  quantity           Int               @default(1)
  product            Product[]         @relation("CartItem_product")
  consignmentProduct ConsignmentSale[] @relation("CartItem_consignmentProduct")

  @@index([userId])
}

model ConsigmentRaising {
  id String @id @default(cuid())
}

model ConsignmentSale {
  id                               String      @id @default(cuid())
  name                             String      @default("")
  birth                            Int
  sex                              String      @default("")
  medical                          String      @default("")
  size                             Int
  price                            Int?
  description                      String      @default("")
  generic                          String      @default("")
  photo                            Gallery?    @relation("ConsignmentSale_photo", fields: [photoId], references: [id])
  photoId                          String?     @unique @map("photo")
  category                         String      @default("")
  estimatedPrice                   String      @default("")
  slug                             String      @default("")
  status                           String?     @default("Không có sẵn")
  from_OrderItem_consignmentSale   OrderItem[] @relation("OrderItem_consignmentSale")
  from_CartItem_consignmentProduct CartItem[]  @relation("CartItem_consignmentProduct")
  from_Request_consignment         Request[]   @relation("Request_consignment")
}

model Request {
  id            String           @id @default(cuid())
  user          User?            @relation("Request_user", fields: [userId], references: [id])
  userId        String?          @map("user")
  staff         User?            @relation("Request_staff", fields: [staffId], references: [id])
  staffId       String?          @map("staff")
  description   String           @default("")
  consignment   ConsignmentSale? @relation("Request_consignment", fields: [consignmentId], references: [id])
  consignmentId String?          @map("consignment")
  status        String?          @default("Chờ phê duyệt")
  statusHistory Status[]         @relation("Status_request")
  createAt      DateTime?        @default(now())

  @@index([userId])
  @@index([staffId])
  @@index([consignmentId])
}

model Gallery {
  id      String           @id @default(cuid())
  title   String           @default("Hình ảnh")
  image   String?
  product ConsignmentSale? @relation("ConsignmentSale_photo")
}

model Status {
  id          String    @id @default(cuid())
  status      String    @default("")
  changeTime  DateTime? @default(now())
  changedBy   User?     @relation("Status_changedBy", fields: [changedById], references: [id])
  changedById String?   @map("changedBy")
  request     Request?  @relation("Status_request", fields: [requestId], references: [id])
  requestId   String?   @map("request")

  @@index([changedById])
  @@index([requestId])
}
